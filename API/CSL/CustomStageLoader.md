---
name: CustomStageLoader
inherits: Node2D

properties:
  - name: API
    type: Variant
    description: The stage loader's API instance variable. When loading stages, this variable is flushed and replace with a new API instance. See [CustomStageAPI](API/CSL/CustomStageAPI.md)
  - name: stage_data
    type: Dictionary
    description: Holds the data of the currently selected stage. Is refreshed using the [`update_stage_selection`](#update_stage_selection) function whenever a stage is loaded.
  - name: stage_holder
    type: Variant
    description: The root StageCanvas that holds all stage materials. See [StageCanvas](API/StageCanvas.md)
  - name: cur_stage
    type: int
    default: 0
    description: Current stage selection as array index.
  - name: stages
    type: "Dictionary[]"
    default: "[]"
    description: The array that holds all present array data.
methods:
  - name: select_stage
    args:
      - name: stage_idx
        type: int
        default: 0
    description: Changes the [`cur_stage`](#cur_stage) variable to the specified `stage_idx`. Also calls [`update_stage_selection`](#update_stage_selection).
  - name: add_stage
    returns: "Dictionary[]"
    args:
      - name: new_stage
        type: Dictionary
    description: |
      This function adds a stage to the [`stages`](#stages) list. Requires metadata generated by a [CustomStageBuilder](API/CSL/CustomStageBuilder) instance.

      Returns the [`stages`](#stages) list.
  - name: update_stage_selection
    returns: bool
    description: |
      Makes sure stage selection is within the [`stages`](#stages) list's range, and sets [`cur_stage`](#cur_stage) and [`stage_data`](#stage_data) accordingly.

      Returns `true` if no stages are present, or `false` if the selection was updated.
  - name: no_stages_present
    returns: bool
    description: |
      Returns `true` if [`stages`](#stages) is not empty, otherwise returns `false`.
  - name: load_stage
    args:
      - name: root
        type: Variant
    description: |
      This function handles the loading of the stage itself. It takes in a `root` node, which is typically the Main node.

      Within this function, `StageBackground`s are checked to see if their `layer` properties pop above or below specific nodes found underneath Main.
      The stage loader adapts to these checks and makes sure that UI is always above the stage, and the BGLayer is always below it.

      At the end of this method, the stage's root [`StageCanvas`](API/StageCanvas) emits a signal saying that the game has been changed, which then causes all materials
      to update their references, giving them fresh access to the Game node.
---

# CustomStageLoader

{{{renderInherits}}}

{{{renderInheritedBy}}}

This is the class used for loading stages. This class is normally referenced by its instance found in the root, the {{{CSL}}} node.

[](../../notice.md ':include')

## Description

This class holds the list of stages currently available to load, and manages the active loading of stages on game start. 
An instance of this node can usually be found in the root of the scene tree.

```gdscript
get_tree().get_root().get_node("CSL");
```

### The `loaded_by` Hook

When materials are loaded from the root of the [`stage_data.materials`](#stage_data) array by the [`load_stage`](#load_stage) method, said material will be placed in the spot
specified by the material's `loaded_by` property. If the material doesn't have that property, it's loaded directly underneath the [`stage_holder`](#stage_holder) node.

## Properties

{{{renderPropertyTable}}}
## Methods

{{{renderMethodTable}}}
## Property Descriptions

{{{renderPropertyDescriptions}}}
## Method Descriptions

{{{renderMethodDescriptions}}}
