---
name: StageElement
inherits: TilingAnimatedSprite

properties:
  - name: game
    type: "Node2D"
    description: Holds a reference to the current game scene.

  - name: stage_root
    type: "StageCanvas"
    description: References the stage's root StageCanvas instance.

  - name: current_tick
    type: "int"
    default: -1
    description: Holds the current game tick, which is recieved from the [game node](#game).

  - name: active
    type: "bool"
    default: "false"
    description: Determines if the sprite is animating or not.

  - name: data
    type: "Dictionary"
    description: |
        Holds this object's material metadata, which is generated by [*CustomStageBuilder*](./CSL/CustomStageBuilder).
        This variable is filled when the object is initialized.

  - name: ticks_per_frame
    type: "int"
    default: 1
    description: Determines how fast the animation plays. Higher values means more ticks are waited between each frame change.

methods:
  - name: _on_tick_changed
    args:
      - name: new_tick
        type: int
        default: 0
    description: |
        This function is bound to the stage root's [`tick_changed`](./StageCanvas#tick_changed) signal.
        Updates the [`current_tick`](#current_tick) and calls [`_tick()`](#_tick).

  - name: _on_game_changed
    description: |
        This function is bound to the stage root's [`game_changed`](./StageCanvas#game_changed) signal.
        Gets a new [`game`](#game) reference from the [`stage_root`](#stage_root) and updates the [`current_tick`](#current_tick) with the new [`game`](#game)'s tick.

  - name: _tick
    description: Simply calls [`_next_frame()`](#_next_frame) if this element is [`active`](#active).

  - name: _next_frame
    description: Updates this element's sprite frame to match the current game tick. Utilizes [`wrap_around_range`](#wrap_around_range) to loop the animation.

  - name: wrap_around_range
    args:
      - name: value
        type: "int"
      - name: start
        type: "int"
      - name: end
        type: "int"
    returns: "int"
    description: |
        Returns the `value` inputted wrapped around the range from `start` to `end`. 
        If value is below `start`, adds the absolute difference between `end` and `start` until the value is within the range, and vice versa.

  - name: play
    args:
      - name: anim
        type: "String"
        default: "Default"
    description: Sets the animation of this element to the `anim` provided.

  - name: pause
    description: Stops the sprite from animating by setting [`active`](#active) to `false`.
---

{{{renderName}}}

{{{renderInherits}}}

{{{renderInheritedBy}}}

This class is the main holder for tiling animated sprites in the stage.

[](../notice.md ':include')

## Description

This class holds a tileable animated/static sprite. It automatically latches to the stage's [`tick_changed`](./StageCanvas#tick_changed) signal. See [*Root hooks*](../root_hooks.md)

Some values of this class are set after the object is ready.

The [`frames`](#frames) property is loaded from the [`data`](#data) dictionary. 
If the `data.frames` value is a String, then it'll be treated as a path. Otherwise, `data.frames` is treated as a reference to a SpriteFrames instance.

The [`stage_root`](#stage_root) property is pulled from `data.stage_root`, as all material data contains that key.

## Properties

{{{renderPropertyTable}}}
## Methods

{{{renderMethodTable}}}
## Property Descriptions

{{{renderPropertyDescriptions}}}
## Method Descriptions

{{{renderMethodDescriptions}}}
